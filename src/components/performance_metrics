import React, { useState } from 'react';

const AttendanceModule = () => {
  const [status, setStatus] = useState('idle'); // idle, scanning, success, error
  const [location, setLocation] = useState(null);

  const handleAttendance = () => {
    setStatus('scanning');
    
    // 1. Location Access
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition((position) => {
        setLocation({
          lat: position.coords.latitude,
          lng: position.coords.longitude
        });
        
        // 2. Fake Facial Scan delay (Simulation)
        setTimeout(() => {
          setStatus('success');
        }, 2000);
      }, () => {
        setStatus('error');
        alert("Please enable location to mark attendance at work site.");
      });
    }
  };

  return (
    <div className="p-6 max-w-sm mx-auto bg-white rounded-xl shadow-md flex flex-col items-center space-y-4 border-2 border-blue-500">
      <h2 className="text-xl font-bold text-gray-800">MCD Attendance Portal</h2>
      
      {status === 'idle' && (
        <button 
          onClick={handleAttendance}
          className="bg-blue-600 text-white px-6 py-3 rounded-full font-semibold hover:bg-blue-700 transition"
        >
          Mark Attendance (Biometric)
        </button>
      )}

      {status === 'scanning' && (
        <div className="flex flex-col items-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
          <p className="mt-2 text-blue-600 animate-pulse">Scanning Face & Verifying Location...</p>
        </div>
      )}

      {status === 'success' && (
        <div className="text-center">
          <div className="text-green-500 text-5xl mb-2">âœ…</div>
          <p className="text-green-700 font-bold">Attendance Marked!</p>
          <p className="text-xs text-gray-500 mt-1">Location: {location?.lat.toFixed(4)}, {location?.lng.toFixed(4)}</p>
          <p className="text-xs text-blue-500 font-medium italic mt-2 text-center">Ghost Employee Check: Clear</p>
        </div>
      )}
    </div>
  );
};

export default AttendanceModule;